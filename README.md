## Amazon ECS on AWS Outposts

Requirements:
* Update providers file with your information
* Check terraform version v0.13
* Create or modifty tfvar file with your information (under vars folder)

Deployment:
terraform init
terraform plan -var-file=vars/test.tfvars  -target=module.ecs-docker-codebuild
terraform apply -var-file=vars/test.tfvars  -target=module.ecs-docker-codebuild
terraform plan -var-file=vars/test.tfvars
terraform apply -var-file=vars/test.tfvars


## Security

See [CONTRIBUTING](CONTRIBUTING.md#security-issue-notifications) for more information.

## License

This library is licensed under the MIT-0 License. See the LICENSE file.

## VPC Module

| Input Variable                                  | Optional / Mandatory | type         | default               |  description                                                                                                                                                                                                                                                                  |
|-------------------------------------------------|----------------------|--------------|-----------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Identifier & tags                               |                      |              |                       |                                                                                                                                                                                                                                                                               |
| vpc_name                                        | Required             | string       |                       | Name to be used for the vpc and all the resources as identifier                                                                                                                                                                                                               |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| vpc_suffix                                      | optional             | string       | “”                    | suffix to append to the VPC name                                                                                                                                                                                                                                              |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| tags                                            | optional             | string       | {}                    | A map of tags to add to all resources                                                                                                                                                                                                                                         |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| VPC CIDR blocks                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| vpc_main_cidr                                   | Required             | string       |                       | The main CIDR block for the VPC                                                                                                                                                                                                                                               |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| enable_ipv6                                     | optional             | bool         | FALSE                 | Requests an Amazon-provided IPv6 CIDR block with a /56 prefix length for the VPC. You cannot specify the range of IP addresses, or the size of the CIDR block.                                                                                                                |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| secondary_cidr_blocks                           | optional             | list(string) | []                    | List of secondary CIDR blocks to associate with the VPC to extend the IP Address pool                                                                                                                                                                                         |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| VPC characteristics                             |                      |              |                       |                                                                                                                                                                                                                                                                               |
| enable_dns_hostnames                            | optional             | bool         | FALSE                 | Should be true to enable DNS hostnames in the VPC                                                                                                                                                                                                                             |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| enable_dns_support                              | optional             | bool         | TRUE                  | Should be true to enable DNS support in the VPC                                                                                                                                                                                                                               |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| instance_tenancy                                | optional             | string       | default               | A tenancy option for instances launched into the VPC                                                                                                                                                                                                                          |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| enable_internet_gateway                         | optional             | bool         | FALSE                 | Should be true if you want to provision Internet Gateways for your public subnets                                                                                                                                                                                             |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| enable_nat_gateway                              | optional             | bool         | FALSE                 | Should be true if you want to provision NAT Gateways for each of your private networks                                                                                                                                                                                        |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| Subnet characteristics                          |                      |              |                       |                                                                                                                                                                                                                                                                               |
| number_AZ                                       |                      | number       | 2                     | This field is used if you need to create more than one subnet per AZ. Specify the number of AZ's (default 2). In the variable *_subnets_cidr_list, the order should be [CIDR subnet 1 AZ A, CIDR subnet 2 AZ B, CIDR subnet 3 AZ A...]                                        |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| private_subnets_cidr_list                       |                      | list(string) | []                    | A list of private subnet CIDR blocks inside the VPC                                                                                                                                                                                                                           |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| private_subnets_suffix                          |                      | string       | private               | private_subnets_suffix                                                                                                                                                                                                                                                        |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| private_subnets_internet_access_nat_gw          |                      | bool         | FALSE                 | Enable connectivity with nat gw. Boolean. False by default                                                                                                                                                                                                                    |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| tgw_subnets_cidr_list                           |                      | list(string) | []                    | A list of transit gateway private subnets CIDR blocks inside the VPC (for endpoints, eni, etc.)                                                                                                                                                                               |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| tgw_subnets_suffix                              |                      | string       | Tgw-private           | Suffix to append to transit gateway private subnets name                                                                                                                                                                                                                      |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| tgw_subnets_internet_access_nat_gw              |                      | bool         | FALSE                 | Enable connectivity with nat gw. Boolean. False by default.                                                                                                                                                                                                                   |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| fw_subnets_cidr_list                            |                      | list(string) | []                    | A list of network firewall subnets CIDR blocks inside the VPC                                                                                                                                                                                                                 |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| fw_subnets_suffix                               |                      | string       | network-fw            | Suffix to append to network firewall subnets name                                                                                                                                                                                                                             |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| fw_subnets_internet_access_nat_gw               |                      | bool         | FALSE                 | Enable connectivity with nat gw. Boolean. False by default.                                                                                                                                                                                                                   |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| public_subnets_cidr_list                        |                      | list(string) | []                    | A list of public subnet CIDR blocks inside the VPC                                                                                                                                                                                                                            |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| public_subnets_suffix                           |                      | string       | public                | Suffix to append to public subnets name                                                                                                                                                                                                                                       |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| web_tier_subnets_cidr_list                      |                      | list(string) | []                    | A list of web tier subnet CIDR blocks inside the VPC                                                                                                                                                                                                                          |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| web_subnets_suffix                              |                      | string       | web                   | Suffix to append to web subnets name                                                                                                                                                                                                                                          |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| web_subnets_internet_access_nat_gw              |                      | bool         | FALSE                 | connectivity with nat gw. Boolean. False by default.                                                                                                                                                                                                                          |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| pres_tier_subnets_cidr_list                     |                      | list(string) | []                    | A list of presentation tier subnet CIDR blocks inside the VPC                                                                                                                                                                                                                 |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| pres_subnets_suffix                             |                      | string       | presentation          | Suffix to append to presentation subnets name                                                                                                                                                                                                                                 |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| database_tier_subnets_cidr_list                 |                      | list(string) | []                    | A list of database tier subnet CIDR blocks inside the VPC                                                                                                                                                                                                                     |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| database_subnets_suffix                         |                      | string       | database              | Suffix to append to database subnets name                                                                                                                                                                                                                                     |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| Outposts characteristics                        |                      |              |                       |                                                                                                                                                                                                                                                                               |
| outposts_subnets_cidr_list                      |                      | list(string) | []                    | A list of outposts subnet CIDR blocks inside the VPC                                                                                                                                                                                                                          |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| outposts_subnets_suffix                         |                      | string       | outposts              | Suffix to append to outposts subnets name                                                                                                                                                                                                                                     |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| outposts_arn                                    |                      | string       | “”                    | Arn of the outposts where the subnets will be launched                                                                                                                                                                                                                        |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| outposts_route_to_LGW_destination               |                      | string       | “”                    | IPv4 CIDR block destination to route to LGW in outposts subnet                                                                                                                                                                                                                |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| outposts_local_gateway_id                       |                      | string       | “”                    | Outposts local gateway ID                                                                                                                                                                                                                                                     |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| SSM                                             |                      |              |                       |                                                                                                                                                                                                                                                                               |
| enable_ssm                                      |                      | bool         | FALSE                 | Enable SSM for EC2 instances. If true, IAM role and endpoints will be deployed                                                                                                                                                                                                |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| DHCP Options                                    |                      |              |                       |                                                                                                                                                                                                                                                                               |
| enable_dhcp_options                             |                      | bool         | FALSE                 | Should be true if you want to specify a DHCP options set with a custom domain name, DNS servers, NTP servers, netbios servers, and/or netbios server type                                                                                                                     |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| dhcp_options_domain_name                        |                      | string       | “”                    | Specifies DNS name for DHCP options set (requires enable_dhcp_options set to true)                                                                                                                                                                                            |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| dhcp_options_domain_name_servers                |                      | list(string) | ["AmazonProvidedDNS"] | Specify a list of DNS server addresses for DHCP options set, default to AWS provided (requires enable_dhcp_options set to true)                                                                                                                                               |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| dhcp_options_ntp_servers                        |                      | list(string) | []                    | Specify a list of NTP servers for DHCP options set (requires enable_dhcp_options set to true)                                                                                                                                                                                 |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| dhcp_options_netbios_name_servers               |                      | list(string) | []                    | Specify a list of netbios servers for DHCP options set (requires enable_dhcp_options set to true)                                                                                                                                                                             |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| dhcp_options_netbios_node_type                  |                      | string       | “”                    | Specify netbios node_type for DHCP options set (requires enable_dhcp_options set to true)                                                                                                                                                                                     |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| FLOW LOGS                                       |                      |              |                       |                                                                                                                                                                                                                                                                               |
| enable_flow_log                                 |                      | bool         | FALSE                 | Whether or not to enable CW VPC Flow Logs                                                                                                                                                                                                                                     |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| create_flow_log_cloudwatch_log_group            |                      | Bool         | FALSE                 | Whether to create CloudWatch log group for VPC Flow Logs                                                                                                                                                                                                                      |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| create_flow_log_cloudwatch_iam_role             |                      | Bool         | FALSE                 | Whether to create IAM role for VPC Flow Logs                                                                                                                                                                                                                                  |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| flow_log_traffic_type                           |                      | String       | “ALL”                 | The type of traffic to capture. Valid values: ACCEPT, REJECT, ALL.                                                                                                                                                                                                            |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| flow_log_destination_type                       |                      | String       | "cloud-watch-logs"    | Type of flow log destination. Can be s3 or cloud-watch-logs                                                                                                                                                                                                                   |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| flow_log_log_format                             |                      | String       | null                  | The fields to include in the flow log record, in the order in which they should appear.                                                                                                                                                                                       |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| flow_log_destination_arn                        |                      | String       | “”                    | The ARN of the CloudWatch log group or S3 bucket where VPC Flow Logs will be pushed. If this ARN is a S3 bucket the appropriate permissions need to be set on that bucket's policy. When create_flow_log_cloudwatch_log_group is set to false this argument must be provided. |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| flow_log_cloudwatch_iam_role_arn                |                      | String       | “”                    | The ARN for the IAM role that's used to post flow logs to a CloudWatch Logs log group. When flow_log_destination_arn is set to ARN of Cloudwatch Logs, this argument needs to be provided.                                                                                    |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| flow_log_cloudwatch_log_group_name_prefix       |                      | String       | "/aws/vpc-flow-log/"  | Specifies the name prefix of CloudWatch Log Group for VPC flow logs.                                                                                                                                                                                                          |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| flow_log_cloudwatch_log_group_retention_in_days |                      | number       | null                  | Specifies the number of days you want to retain log events in the specified log group for VPC flow logs.                                                                                                                                                                      |
|                                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
# example for VPC module

```
module "test-vpc" {
   source            = "./modules/vpc"
   tags              = local.common_tags
   vpc_name          = var.vpc_name
   vpc_suffix        = var.vpc_suffix 
   vpc_main_cidr   = "10.181.192.0/19"
   enable_ipv6       = false
   enable_dns_hostnames = true
   enable_dns_support   = true
   enable_internet_gateway = true
   enable_nat_gateway  = true
   enable_ssm          = true

   number_AZ             = 2
  
   private_subnets_cidr_list       = ["10.181.220.0/24", "10.181.221.0/24"]
   outposts_subnets_cidr_list           = ["10.181.222.64/27", "10.181.222.96/27"]
   public_subnets_cidr_list     = ["10.181.194.0/23", "10.181.200.0/23"]
  
   outposts_arn   = var.outposts_arn
   outposts_route_to_LGW_destination = var.outposts_route_to_LGW_destination
   outposts_local_gateway_id   = var.outposts_local_gateway_id
 }
```
