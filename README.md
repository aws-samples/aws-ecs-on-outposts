## Amazon ECS on AWS Outposts

Introduction:

This repository gives customers the right content to deploy Amazon ECS cluster on AWS Outposts. The showed architecture is not meant to be deployed in a production environment, but to serve as a template and a model. There are three modules provided here (under terraform/modules):
* ALB + ECS
* docker image + ECR + codebuild
* VPC

Under terraform folder, customers can find the test files used to deploy an example solution:
* 1-test-outposts-vpc.tf
* 2-test-ec2-client-instance.tf
* 3-test-docker-ecr-codebuild.tf
* 4-test-alb-ecs.tf
* 5-test-kinesis-stream.tf
* 6-test-kinesis-stream.tf

Requirements:
* Update providers file with your information
* Terraform version v0.13
* Create or modifty tfvar file with your information (under vars folder)
* You must have installed and configured an AWS Outposts in your on-premises
datacenter.

This is the required information that you need to collect from your environment before the deployment:
* AWS Outposts ARN
* AWS Outposts Local Gateway ID


Deployment:
* terraform init
* terraform plan -var-file=vars/test.tfvars  -target=module.ecs-docker-codebuild
* terraform apply -var-file=vars/test.tfvars  -target=module.ecs-docker-codebuild
* terraform plan -var-file=vars/test.tfvars
* terraform apply -var-file=vars/test.tfvars


## Security

See [CONTRIBUTING](CONTRIBUTING.md#security-issue-notifications) for more information.

## License

This library is licensed under the MIT-0 License. See the LICENSE file.

## VPC Module

| Input Variable                                  | Optional / Mandatory | type         | default               |  description                                                                                                                                                                                                                                                                  |
|-------------------------------------------------|----------------------|--------------|-----------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1.Identifier & tags                               |                      |              |                       |                                                                                                                                                                                                                                                                               |
| vpc_name                                        | Required             | string       |                       | Name to be used for the vpc and all the resources as identifier                                                                                                                                                                                                               |
| vpc_suffix                                      | optional             | string       | ""                    | suffix to append to the VPC name                                                                                                                                                                                                                                              |
| tags                                            | optional             | string       | {}                    | A map of tags to add to all resources                                                                                                                                                                                                                                         |
| 2.VPC CIDR blocks                                 |                      |              |                       |                                                                                                                                                                                                                                                                               |
| vpc_main_cidr                                   | Required             | string       |                       | The main CIDR block for the VPC                                                                                                                                                                                                                                               |
| enable_ipv6                                     | optional             | bool         | FALSE                 | Requests an Amazon-provided IPv6 CIDR block with a /56 prefix length for the VPC. You cannot specify the range of IP addresses, or the size of the CIDR block.                                                                                                                |
| secondary_cidr_blocks                           | optional             | list(string) | []                    | List of secondary CIDR blocks to associate with the VPC to extend the IP Address pool                                                                                                                                                                                         |
| 3.VPC characteristics                             |                      |              |                       |                                                                                                                                                                                                                                                                               |
| enable_dns_hostnames                            | optional             | bool         | FALSE                 | Should be true to enable DNS hostnames in the VPC                                                                                                                                                                                                                             |
| enable_dns_support                              | optional             | bool         | TRUE                  | Should be true to enable DNS support in the VPC                                                                                                                                                                                                                               |
| instance_tenancy                                | optional             | string       | default               | A tenancy option for instances launched into the VPC                                                                                                                                                                                                                          |
| enable_internet_gateway                         | optional             | bool         | FALSE                 | Should be true if you want to provision Internet Gateways for your public subnets                                                                                                                                                                                             |
| enable_nat_gateway                              | optional             | bool         | FALSE                 | Should be true if you want to provision NAT Gateways for each of your private networks                                                                                                                                                                                        |
| Subnet characteristics                          |                      |              |                       |                                                                                                                                                                                                                                                                               |
| number_AZ                                       | optional             | number       | 2                     | This field is used if you need to create more than one subnet per AZ. Specify the number of AZ's (default 2). In the variable *_subnets_cidr_list, the order should be [CIDR subnet 1 AZ A, CIDR subnet 2 AZ B, CIDR subnet 3 AZ A...]                                        |
| private_subnets_cidr_list                       | optional             | list(string) | []                    | A list of private subnet CIDR blocks inside the VPC                                                                                                                                                                                                                           |
| private_subnets_suffix                          | optional             | string       | private               | private_subnets_suffix                                                                                                                                                                                                                                                        |
| private_subnets_internet_access_nat_gw          | optional             | bool         | FALSE                 | Enable connectivity with nat gw. Boolean. False by default                                                                                                                                                                                                                    |
| tgw_subnets_cidr_list                           | optional             | list(string) | []                    | A list of transit gateway private subnets CIDR blocks inside the VPC (for endpoints, eni, etc.)                                                                                                                                                                               |
| tgw_subnets_suffix                              | optional             | string       | Tgw-private           | Suffix to append to transit gateway private subnets name                                                                                                                                                                                                                      |
| tgw_subnets_internet_access_nat_gw              | optional             | bool         | FALSE                 | Enable connectivity with nat gw. Boolean. False by default.                                                                                                                                                                                                                   |
| fw_subnets_cidr_list                            | optional             | list(string) | []                    | A list of network firewall subnets CIDR blocks inside the VPC                                                                                                                                                                                                                 |
| fw_subnets_suffix                               | optional             | string       | network-fw            | Suffix to append to network firewall subnets name                                                                                                                                                                                                                             |
| fw_subnets_internet_access_nat_gw               | optional             | bool         | FALSE                 | Enable connectivity with nat gw. Boolean. False by default.                                                                                                                                                                                                                   |
| public_subnets_cidr_list                        | optional             | list(string) | []                    | A list of public subnet CIDR blocks inside the VPC                                                                                                                                                                                                                            |
| public_subnets_suffix                           | optional             | string       | public                | Suffix to append to public subnets name                                                                                                                                                                                                                                       |
| web_tier_subnets_cidr_list                      | optional             | list(string) | []                    | A list of web tier subnet CIDR blocks inside the VPC                                                                                                                                                                                                                          |
| web_subnets_suffix                              | optional             | string       | web                   | Suffix to append to web subnets name                                                                                                                                                                                                                                          |
| web_subnets_internet_access_nat_gw              | optional             | bool         | FALSE                 | connectivity with nat gw. Boolean. False by default.                                                                                                                                                                                                                          |
| pres_tier_subnets_cidr_list                     | optional             | list(string) | []                    | A list of presentation tier subnet CIDR blocks inside the VPC                                                                                                                                                                                                                 |
| pres_subnets_suffix                             | optional             | string       | presentation          | Suffix to append to presentation subnets name                                                                                                                                                                                                                                 |
| database_tier_subnets_cidr_list                 | optional             | list(string) | []                    | A list of database tier subnet CIDR blocks inside the VPC                                                                                                                                                                                                                     |
| database_subnets_suffix                         | optional             | string       | database              | Suffix to append to database subnets name                                                                                                                                                                                                                                     |
| 4.Outposts characteristics                        |                      |              |                       |                                                                                                                                                                                                                                                                               |
| outposts_subnets_cidr_list                      | optional             | list(string) | []                    | A list of outposts subnet CIDR blocks inside the VPC                                                                                                                                                                                                                          |
| outposts_subnets_suffix                         | optional             | string       | outposts              | Suffix to append to outposts subnets name                                                                                                                                                                                                                                     |
| outposts_arn                                    | optional             | string       | ""                    | Arn of the outposts where the subnets will be launched                                                                                                                                                                                                                        |
| outposts_route_to_LGW_destination               | optional             | string       | ""                    | IPv4 CIDR block destination to route to LGW in outposts subnet                                                                                                                                                                                                                |
| outposts_local_gateway_id                       | optional             | string       | ""                    | Outposts local gateway ID                                                                                                                                                                                                                                                     |
| SSM                                             |                      |              |                       |                                                                                                                                                                                                                                                                               |
| enable_ssm                                      | optional             | bool         | FALSE                 | Enable SSM for EC2 instances. If true, IAM role and endpoints will be deployed                                                                                                                                                                                                |
| create_iam_role_ssm                             | optional             | Bool         | FALSE                 | Enable or disable the creation of an IAM role for EC2 instances to connect using SSM                                                                                                                                                                                          |
| 5.DHCP Options                                    |                      |              |                       |                                                                                                                                                                                                                                                                               |
| enable_dhcp_options                             | optional             | bool         | FALSE                 | Should be true if you want to specify a DHCP options set with a custom domain name, DNS servers, NTP servers, netbios servers, and/or netbios server type                                                                                                                     |
| dhcp_options_domain_name                        | optional             | string       | ""                    | Specifies DNS name for DHCP options set (requires enable_dhcp_options set to true)                                                                                                                                                                                            |
| dhcp_options_domain_name_servers                | optional             | list(string) | ["AmazonProvidedDNS"] | Specify a list of DNS server addresses for DHCP options set, default to AWS provided (requires enable_dhcp_options set to true)                                                                                                                                               |
| dhcp_options_ntp_servers                        | optional             | list(string) | []                    | Specify a list of NTP servers for DHCP options set (requires enable_dhcp_options set to true)                                                                                                                                                                                 |
| dhcp_options_netbios_name_servers               | optional             | list(string) | []                    | Specify a list of netbios servers for DHCP options set (requires enable_dhcp_options set to true)                                                                                                                                                                             |
| dhcp_options_netbios_node_type                  | optional             | string       | ""                    | Specify netbios node_type for DHCP options set (requires enable_dhcp_options set to true)                                                                                                                                                                                     |
| 6.Flow logs                                      |                      |              |                       |                                                                                                                                                                                                                                                                               |
| enable_flow_log                                 | optional             | bool         | FALSE                 | Whether or not to enable CW VPC Flow Logs                                                                                                                                                                                                                                     |
| create_flow_log_cloudwatch_log_group            | optional             | Bool         | FALSE                 | Whether to create CloudWatch log group for VPC Flow Logs                                                                                                                                                                                                                      |
| create_flow_log_cloudwatch_iam_role             | optional             | Bool         | FALSE                 | Whether to create IAM role for VPC Flow Logs                                                                                                                                                                                                                                  |
| flow_log_traffic_type                           | optional             | String       | "ALL"                 | The type of traffic to capture. Valid values: ACCEPT, REJECT, ALL.                                                                                                                                                                                                            |
| flow_log_destination_type                       | optional             | String       | "cloud-watch-logs"    | Type of flow log destination. Can be s3 or cloud-watch-logs                                                                                                                                                                                                                   |
| flow_log_log_format                             | optional             | String       | null                  | The fields to include in the flow log record, in the order in which they should appear.                                                                                                                                                                                       |
| flow_log_destination_arn                        | optional             | String       | ""                    | The ARN of the CloudWatch log group or S3 bucket where VPC Flow Logs will be pushed. If this ARN is a S3 bucket the appropriate permissions need to be set on that bucket's policy. When create_flow_log_cloudwatch_log_group is set to false this argument must be provided. |
| flow_log_cloudwatch_iam_role_arn                | optional             | String       | ""                    | The ARN for the IAM role that's used to post flow logs to a CloudWatch Logs log group. When flow_log_destination_arn is set to ARN of Cloudwatch Logs, this argument needs to be provided.                                                                                    |
| flow_log_cloudwatch_log_group_name_prefix       | optional             | String       | "/aws/vpc-flow-log/"  | Specifies the name prefix of CloudWatch Log Group for VPC flow logs.                                                                                                                                                                                                          |
| flow_log_cloudwatch_log_group_retention_in_days | optional             | number       | null                  | Specifies the number of days you want to retain log events in the specified log group for VPC flow logs.                                                                                                                                                                      |                                                                                                                                                                                                                                                                             |
# example for VPC module

```
module "test-vpc" {
   source            = "./modules/vpc"
   tags              = local.common_tags
   vpc_name          = var.vpc_name
   vpc_suffix        = var.vpc_suffix 
   vpc_main_cidr   = "10.181.192.0/19"
   enable_ipv6       = false
   enable_dns_hostnames = true
   enable_dns_support   = true
   enable_internet_gateway = true
   enable_nat_gateway  = true
   enable_ssm          = true

   number_AZ             = 2
  
   private_subnets_cidr_list       = ["10.181.220.0/24", "10.181.221.0/24"]
   outposts_subnets_cidr_list           = ["10.181.222.64/27", "10.181.222.96/27"]
   public_subnets_cidr_list     = ["10.181.194.0/23", "10.181.200.0/23"]
  
   outposts_arn   = var.outposts_arn
   outposts_route_to_LGW_destination = var.outposts_route_to_LGW_destination
   outposts_local_gateway_id   = var.outposts_local_gateway_id
 }
```


## AB + ECS Module


| Input Variable                                   | Optional / Mandatory | type                                                                                                                                                                                                                                                                                                                                                                                                                                         | default                                                                                                                                                                                                                                                                                                                      |  description                                                                                                                                                                                                                                                                                                                                     |
|--------------------------------------------------|----------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|  1.Project related                                 |                      |                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                                                                                                  |
| tags                                             | Required             | map(string)                                                                                                                                                                                                                                                                                                                                                                                                                                  |                                                                                                                                                                                                                                                                                                                              | Tags to apply to the resources                                                                                                                                                                                                                                                                                                                   |
| vpc_name                                         | Required             | string                                                                                                                                                                                                                                                                                                                                                                                                                                       |                                                                                                                                                                                                                                                                                                                              | name of the VPC where the resources will be deployed                                                                                                                                                                                                                                                                                             |
| 2.Application Load Balancer                        |                      |                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                                                                                                  |
| alb_name                                         | Required             | string                                                                                                                                                                                                                                                                                                                                                                                                                                       |                                                                                                                                                                                                                                                                                                                              | Name of the application load balancer                                                                                                                                                                                                                                                                                                            |
| subnets                                          | Required             | list(string)                                                                                                                                                                                                                                                                                                                                                                                                                                 |                                                                                                                                                                                                                                                                                                                              | A list of subnet IDs to associate with the load balancer                                                                                                                                                                                                                                                                                         |
| custom_zone                                      | Optional             | bool                                                                                                                                                                                                                                                                                                                                                                                                                                         | FALSE                                                                                                                                                                                                                                                                                                                        | True for using a custom domain name for the ALB. A certificate will be created too. Protocol should be HTTPS                                                                                                                                                                                                                                     |
| zone_id                                          | Optional             | string                                                                                                                                                                                                                                                                                                                                                                                                                                       | ""                                                                                                                                                                                                                                                                                                                           | Zone Id of your custom domain if custom_zone is set to true                                                                                                                                                                                                                                                                                      |
| enable_alb_access_logging                        | Optional             | bool                                                                                                                                                                                                                                                                                                                                                                                                                                         | FALSE                                                                                                                                                                                                                                                                                                                        | true to enable access logging on ALB                                                                                                                                                                                                                                                                                                             |
| logging_bucket_name                              | Optional             | string                                                                                                                                                                                                                                                                                                                                                                                                                                       | ""                                                                                                                                                                                                                                                                                                                           | Name of the s3 bucket to sends access logs from alb                                                                                                                                                                                                                                                                                              |
| alb_access_logs_prefix                           | Optional             | string                                                                                                                                                                                                                                                                                                                                                                                                                                       | "alb/outposts"                                                                                                                                                                                                                                                                                                               | prefix for the access logs sent to s3 bucket from alb                                                                                                                                                                                                                                                                                            |
| port_listeners                                   | Optional             | any                                                                                                                                                                                                                                                                                                                                                                                                                                          | {<br/>    "port-1" = {<br/>      "port"               = 80,<br/>      "protocol"           = "HTTP",<br/>      "inbound_cidr_range" = []<br/>      "target_group" = {<br/>        "port"              = 8080,<br/>        "protocol"          = "HTTP",<br/>        "health_check_path" = "/"<br/>      }<br/>    },<br/>  } | A list of maps describing the HTTP/S listeners for this ALB. Required key/values: port, protocol.                                                                                                                                                                                                                                                |
| alb_enable_deletion_protection                   | Optional             | bool                                                                                                                                                                                                                                                                                                                                                                                                                                         | FALSE                                                                                                                                                                                                                                                                                                                        | True to enable ALB deletion protection                                                                                                                                                                                                                                                                                                           |
| alb_ip_address_type                              | Optional             | string                                                                                                                                                                                                                                                                                                                                                                                                                                       | "ipv4"                                                                                                                                                                                                                                                                                                                       | The type of IP addresses used by the subnets for your load balancer. The possible values are ipv4 and dualstack                                                                                                                                                                                                                                  |
| target_group_deregistration_delay                | Optional             | number                                                                                                                                                                                                                                                                                                                                                                                                                                       | 300                                                                                                                                                                                                                                                                                                                          | The amount time for Elastic Load Balancing to wait before changing the state of a deregistering target from draining to unused                                                                                                                                                                                                                   |
| target_group_health_check_interval               | Optional             | number                                                                                                                                                                                                                                                                                                                                                                                                                                       | 30                                                                                                                                                                                                                                                                                                                           | The approximate amount of time, in seconds, between health checks of an individual target. Minimum value 5 seconds, Maximum value 300 seconds                                                                                                                                                                                                    |
| target_group_health_check_timeout                | Optional             | number                                                                                                                                                                                                                                                                                                                                                                                                                                       | 10                                                                                                                                                                                                                                                                                                                           | The amount of time, in seconds, during which no response means a failed health check. The range is 2 to 120 seconds                                                                                                                                                                                                                              |
| target_group_health_check_matcher                | Optional             | string                                                                                                                                                                                                                                                                                                                                                                                                                                       | "200-399"                                                                                                                                                                                                                                                                                                                    | The response codes to use when checking for a healthy responses from a target                                                                                                                                                                                                                                                                    |
| target_group_healthy_threshold                   | Optional             | number                                                                                                                                                                                                                                                                                                                                                                                                                                       | 3                                                                                                                                                                                                                                                                                                                            | The number of consecutive health checks successes required before considering an unhealthy target healthy                                                                                                                                                                                                                                        |
| target_group_unhealthy_threshold                 | Optional             | number                                                                                                                                                                                                                                                                                                                                                                                                                                       | 3                                                                                                                                                                                                                                                                                                                            | The number of consecutive health check failures required before considering the target unhealthy                                                                                                                                                                                                                                                 |
| 3.Outposts                                         |                      |                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                                                                                                  |
| outposts_arn                                     | Optional             | string                                                                                                                                                                                                                                                                                                                                                                                                                                       | ""                                                                                                                                                                                                                                                                                                                           | Outposts ARN Id if applicable                                                                                                                                                                                                                                                                                                                    |
| 4.ECS                                              |                      |                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                                                                                                  |
| ecs_cluster_name                                 | Required             | string                                                                                                                                                                                                                                                                                                                                                                                                                                       |                                                                                                                                                                                                                                                                                                                              | Name for ECS cluster                                                                                                                                                                                                                                                                                                                             |
| ecs_service                                      | Optional             | object({<br/>    ecs_service_name = string<br/>    desired_count    = number<br/>    launch_type      = string<br/>    container_name   = string<br/>    task_definition = object({<br/>      family = string<br/>      cpu    = number<br/>      memory = number<br/>      port   = number<br/>    })<br/>  })                                                                                                                              | {<br/>    "ecs_service_name" = "ecs-producer",<br/>    "desired_count"    = 1,<br/>    "launch_type"      = "EC2",<br/>    "container_name"   = "producer",<br/>    "task_definition" = {<br/>      "family" = "producer",<br/>      "cpu"    = 512,<br/>      "memory" = 1024,<br/>      "port"   = 8080<br/>    }<br/>  }  | ECS Service specification                                                                                                                                                                                                                                                                                                                        |
| import_aws_ecs_task_definition                   | Optional             | bool                                                                                                                                                                                                                                                                                                                                                                                                                                         | FALSE                                                                                                                                                                                                                                                                                                                        | true if you want to import an existing task definition                                                                                                                                                                                                                                                                                           |
| task_definition_arn                              | Optional             | string                                                                                                                                                                                                                                                                                                                                                                                                                                       | ""                                                                                                                                                                                                                                                                                                                           | Define if you are importing an existing task definition                                                                                                                                                                                                                                                                                          |
| log_group_name                                   | Required             | string                                                                                                                                                                                                                                                                                                                                                                                                                                       |                                                                                                                                                                                                                                                                                                                              | name for AWS CW Log for ECS                                                                                                                                                                                                                                                                                                                      |
| log_retention_days                               | Optional             | number                                                                                                                                                                                                                                                                                                                                                                                                                                       | 365                                                                                                                                                                                                                                                                                                                          | retention period for AWS CW Log                                                                                                                                                                                                                                                                                                                  |
| ecr_name                                         | Optional             | string                                                                                                                                                                                                                                                                                                                                                                                                                                       | kinesis/producer                                                                                                                                                                                                                                                                                                             | name for ECR                                                                                                                                                                                                                                                                                                                                     |
| 5.Capacity Provider                                |                      |                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                                                                                                  |
| ecs_ami_id                                       | Optional             | string                                                                                                                                                                                                                                                                                                                                                                                                                                       | ami-017a715104f93ea81                                                                                                                                                                                                                                                                                                        | AMI ID for EC2 instance/s that will host ECS containers                                                                                                                                                                                                                                                                                          |
| ecs_instance_type                                | Optional             | string                                                                                                                                                                                                                                                                                                                                                                                                                                       | m5.2xlarge                                                                                                                                                                                                                                                                                                                   | instance type for EC2 instance/s that will host ECS containers                                                                                                                                                                                                                                                                                   |
| ec2_iam_instance_profile                         | Required             | string                                                                                                                                                                                                                                                                                                                                                                                                                                       |                                                                                                                                                                                                                                                                                                                              | IAM instance profile ID for EC2 instance that will host ECS container                                                                                                                                                                                                                                                                            |
| 6.ECS Auto Scaling                                 |                      |                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                                                                                                  |
| maximum_scaling_step_size                        | Optional             | number                                                                                                                                                                                                                                                                                                                                                                                                                                       | 1                                                                                                                                                                                                                                                                                                                            | maximum step adjustment size for ECS Auto Scaling                                                                                                                                                                                                                                                                                                |
| minimum_scaling_step_size                        | Optional             | number                                                                                                                                                                                                                                                                                                                                                                                                                                       | 1                                                                                                                                                                                                                                                                                                                            | minimum step adjustment size for ECS Auto Scaling                                                                                                                                                                                                                                                                                                |
| capacity_provider_managed_termination_protection | Optional             | string                                                                                                                                                                                                                                                                                                                                                                                                                                       | "DISABLED"                                                                                                                                                                                                                                                                                                                   | Enable or disable container-aware termination of instances in the auto scaling group when scale-in happens. Valid values are ENABLED and DISABLED                                                                                                                                                                                                |
| capacity_provider_target_capacity                | Optional             | number                                                                                                                                                                                                                                                                                                                                                                                                                                       | 80                                                                                                                                                                                                                                                                                                                           | The target utilization for the capacity provider. A number between 1 and 100                                                                                                                                                                                                                                                                     |
| ecs_asg_name_prefix                              | Optional             | string                                                                                                                                                                                                                                                                                                                                                                                                                                       | "OUTPOST_ECS"                                                                                                                                                                                                                                                                                                                | Creates a unique name beginning with the specified prefix                                                                                                                                                                                                                                                                                        |
| ecs_asg_max_size                                 | Optional             | number                                                                                                                                                                                                                                                                                                                                                                                                                                       | 3                                                                                                                                                                                                                                                                                                                            | The maximum size of the Auto Scaling Group                                                                                                                                                                                                                                                                                                       |
| ecs_asg_min_size                                 | Optional             | number                                                                                                                                                                                                                                                                                                                                                                                                                                       | 0                                                                                                                                                                                                                                                                                                                            | The minimum size of the Auto Scaling Group                                                                                                                                                                                                                                                                                                       |
| ecs_asg_desired_capacity                         | Optional             | number                                                                                                                                                                                                                                                                                                                                                                                                                                       | 1                                                                                                                                                                                                                                                                                                                            | The number of Amazon EC2 instances that should be running in the group                                                                                                                                                                                                                                                                           |
| ecs_asg_health_check_type                        | Optional             | string                                                                                                                                                                                                                                                                                                                                                                                                                                       | "ELB"                                                                                                                                                                                                                                                                                                                        | EC2 or ELB. Controls how health checking is done                                                                                                                                                                                                                                                                                                 |
| ecs_asg_capacity_rebalance                       | Optional             | bool                                                                                                                                                                                                                                                                                                                                                                                                                                         | FALSE                                                                                                                                                                                                                                                                                                                        | Indicates whether capacity rebalance is enabled. Otherwise, capacity rebalance is disabled                                                                                                                                                                                                                                                       |
| ecs_asg_default_cooldown                         | Optional             | number                                                                                                                                                                                                                                                                                                                                                                                                                                       | 300                                                                                                                                                                                                                                                                                                                          | The amount of time, in seconds, after a scaling activity completes before another scaling activity can start                                                                                                                                                                                                                                     |
| ecs_asg_health_check_grace_period                | Optional             | number                                                                                                                                                                                                                                                                                                                                                                                                                                       | 300                                                                                                                                                                                                                                                                                                                          | Time (in seconds) after instance comes into service before checking health                                                                                                                                                                                                                                                                       |
| ecs_asg_termination_policies                     | Optional             | list(any)                                                                                                                                                                                                                                                                                                                                                                                                                                    | []                                                                                                                                                                                                                                                                                                                           | A list of policies to decide how the instances in the Auto Scaling Group should be terminated. The allowed values are OldestInstance, NewestInstance, OldestLaunchConfiguration, ClosestToNextInstanceHour, OldestLaunchTemplate, AllocationStrategy, Default                                                                                    |
| ecs_asg_suspended_processes                      | Optional             | list(any)                                                                                                                                                                                                                                                                                                                                                                                                                                    | []                                                                                                                                                                                                                                                                                                                           | A list of processes to suspend for the Auto Scaling Group. The allowed values are Launch, Terminate, HealthCheck, ReplaceUnhealthy, AZRebalance, AlarmNotification, ScheduledActions, AddToLoadBalancer. Note that if you suspend either the Launch or Terminate process types, it can prevent your Auto Scaling Group from functioning properly |
| ecs_asg_enabled_metrics                          | Optional             | list(any)                                                                                                                                                                                                                                                                                                                                                                                                                                    | []                                                                                                                                                                                                                                                                                                                           | A list of metrics to collect. The allowed values are GroupDesiredCapacity, GroupInServiceCapacity, GroupPendingCapacity, GroupMinSize, GroupMaxSize, GroupInServiceInstances, GroupPendingInstances, GroupStandbyInstances, GroupStandbyCapacity, GroupTerminatingCapacity, GroupTerminatingInstances, GroupTotalCapacity, GroupTotalInstances   |
| ecs_asg_protect_from_scale_in                    | Optional             | bool                                                                                                                                                                                                                                                                                                                                                                                                                                         | FALSE                                                                                                                                                                                                                                                                                                                        | Allows setting instance protection. The Auto Scaling Group will not select instances with this setting for termination during scale in events                                                                                                                                                                                                    |
| ecs_asg_override_config                          | Optional             | list(object({<br/>    instance_type     = string<br/>    weighted_capacity = number<br/>  }))                                                                                                                                                                                                                                                                                                                                                | [<br/>    {<br/>      "instance_type" : "m5.2xlarge"<br/>      "weighted_capacity" : 70<br/>    },<br/>    {<br/>      "instance_type" : "c5.2xlarge"<br/>      "weighted_capacity" : 20<br/>    },<br/>    {<br/>      "instance_type" : "r5.2xlarge"<br/>      "weighted_capacity" : 10<br/>    }<br/>  ]                  | List of nested arguments provides the ability to specify multiple instance types. This will override the same parameter in the launch template. For on-demand instances, Auto Scaling considers the order of preference of instance types to launch based on the order specified in the overrides list                                           |
| import_aws_launch_template                       | Optional             | bool                                                                                                                                                                                                                                                                                                                                                                                                                                         | FALSE                                                                                                                                                                                                                                                                                                                        | True to import an existing aws launch template                                                                                                                                                                                                                                                                                                   |
| launch_template_id                               | Optional             | string                                                                                                                                                                                                                                                                                                                                                                                                                                       | ""                                                                                                                                                                                                                                                                                                                           | Define if import_aws_launch_template is set to true                                                                                                                                                                                                                                                                                              |
| launch_template_name_prefix                      | Optional             | string                                                                                                                                                                                                                                                                                                                                                                                                                                       | "ecs_node_"                                                                                                                                                                                                                                                                                                                  | prefix for launch template of ecs asg                                                                                                                                                                                                                                                                                                            |
| block_device_mappings                            | Optional             | list(object({<br/>    device_name  = string<br/>    no_device    = bool<br/>    virtual_name = string<br/>    ebs = object({<br/>      delete_on_termination = bool<br/>      encrypted             = bool<br/>      iops                  = number<br/>      kms_key_id            = string<br/>      snapshot_id           = string<br/>      volume_size           = number<br/>      volume_type           = string<br/>    })<br/>  })) | []                                                                                                                                                                                                                                                                                                                           | In launch configuration configure additional volumes of the instance besides specified by the AMI                                                                                                                                                                                                                                                |
| kinesis_stream_name                              | Optional             | string                                                                                                                                                                                                                                                                                                                                                                                                                                       | data-processing-stream                                                                                                                                                                                                                                                                                                       | prefix for launch template of ecs asg                                                                                                                                                                                                                                                                                                            |